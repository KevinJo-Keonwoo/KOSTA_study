# νΈλ¦¬κ±°

νΈλ¦¬κ±° : 

- ν• ν…μ΄λΈ”μ— DML(INSERT, UPDATE, DELETE)μ‹¤ν–‰ μ‹ λ‹¤λ¥Έν…μ΄λΈ”μ— 
μλ™μΌλ΅ DMLμ΄ μ‹¤ν–‰λκ² ν•λ” κ²ƒ
- μ κ±°ν•λ ¤λ©΄ DROP TRIGGER ~~
- μΌλ°μ μΈ μƒν™©
    - INSERT μ†΅μ‹  β†’
    - UPDATE μ†΅μ‹  β†’
- νΈλ¦¬κ±° μ‚¬μ©
    - INSERT μ†΅μ‹  β†’ λ‚΄λ¶€ DBμ—μ„ UPDATEμ§„ν–‰    β†’ 1λ² μ†΅μ‹ μΌλ΅ λ„¤νΈμ›ν¬ λΉ„μ© κ°μ†

```sql
CREATE TABLE point(
	point_id VARCHAR2(5) primary key,
	point_score NUMBER(3),
CONSTRAINT point_id_fk FOREIGN KEY(point_id) REFERENCES customer(id)
);
```

- κ³ κ°μ΄ μ¶”κ°€λμλ§μ ν¬μΈνΈν–‰ λ°”λ΅ μλ™μΌλ΅ μ¶”κ°€
- BEFORE/AFTER
    - μ¶”κ°€λμλ§μ β†’ AFTER   μ¶”κ°€λκΈ°λ°”λ΅μ „μ—  β†’ BEFORE
    - AFTER/BEFORE β†’ λ·°μ—λ” μ‚¬μ© λ¶κ°€
    - :NEW μ§€κΈ AFTERμ μ—μ„ μ¶”κ°€λ CUSTOMERν…μ΄λΈ”μ ν–‰
    - :OLD BEFOREμ μ—μ„ μ¶”κ°€λκΈ°μ „μ ν–‰
    - κ³ κ°μ΄ customerμ— μ¶”κ°€λμλ§μ κ°κ°μ ν–‰λ³„λ΅ pointν–‰μ„ μ¶”κ°€ν•λ‹¤. μ¶”κ°€ν• λ• λ§¤κ°λ³€μλ΅λ” customerμ—μ„ μƒλ΅ μ¶”κ°€λ ν–‰μ idλ¥Ό κ°€μ Έμ¤κ³ , 1λ„ κ°€μ Έμ¨λ‹¤

```sql
CREATE OR REPLACE TRIGGER point_trig
AFTER insert ON customer  --customerν…μ΄λΈ”μ— Insert λμλ§μ. BEFORE/AFTERκ°€ μμ
FOR EACH ROW   --κ°κ°μ ν–‰λ³„, ν–‰ λ‹¨μ„λ΅
BEGIN
	INSERT INTO point(point_id, point_score) VALUES (:NEW.id , 1);   --pointν–‰μ„μƒμ„±
END;
```

- μ£Όλ¬Έ 1ν–‰μ΄ μ¶”κ°€λ ν›„ ν¬μΈνΈ 1ν–‰μ μ μκ°€ μλ™ 1μ μ”© μ¦κ°€
    - UPDATEμ SETμ μ—μ„λ” λ€μ…μ μλ―Έκ°€ β€=β€™μ„
    - SQL κµ¬λ¬Έμ—μ„μ λ€μ… : β€=β€™       PL/SQL κµ¬λ¬Έμ—μ„μ λ€μ… : β€:=β€™
    - SQLκµ¬λ¬Έμ—μ„λ” λ€μ…μ„ μ‚¬μ©ν•  κ²½μ°κ°€ UPDATE ~ SET ~ κµ¬λ¬Έλ°–μ—μ—†μ

```sql
CREATE OR REPLACE TRIGGER point1_trig
AFTER insert ON order_info
FOR EACH ROW
BEGIN
UPDATE point SET point_score = point_score + 1 WHERE point_id = :NEW.order_id;
END;
/

INSERT INTO order_info(order_no, order_id, order_dt)
            VALUES (order_seq.NEXTVAL, 'id1', SYSDATE);
SELECT * FROM order_info;
SELECT * FROM point;
```

- κ³ κ°μ΄ μ‚­μ λκΈ° μ§μ „ ν¬μΈνΈν–‰λ„ μλ™ μ‚­μ  
κ³ κ° μ‚­μ  ν›„ ν¬μΈνΈν–‰λ„ μλ™μ‚­μ  (λ¶κ°€λ¥) β†’ μμ‹μ΄ λ¶€λ¨λ³΄λ‹¤ λ¨Όμ € μ‚­μ λμ–΄μ•Ό λ¨

```sql
CREATE OR REPLACE TRIGGER point2_trig
BEFORE delete ON customer
FOR EACH ROW
BEGIN
DELETE point WHERE point_id = :OLD.id;
END;
/
```

β”π‘Ώμ£Όμμ  : νΈλμ­μ…

- νΈλμ­μ… μλ™ μ‹μ‘ (tx-1)

INSERT INTO customer(id, pwd, name, address, status) VALUES ('id1', 'p1', 'n1', 'a1', 1);

β€”> νΈλ¦¬κ±° point_trig(tx-1)

μ΄ μƒνƒμ—μ„ λ‹¤λ¥Έ μ„Έμ…μ—μ„ μ§„ν–‰ν•λ ¤κ³ ν•λ©΄ νΈλμ­μ… λ°μƒ!

![Untitled](%E1%84%90%E1%85%B3%E1%84%85%E1%85%B5%E1%84%80%E1%85%A5%209269d5eac8a343d3907fb90631069f06/Untitled.png)

κΈ°μ΅΄ μ„Έμ…μ„ μ»¤λ°‹ μ™„λ£ν•λ©΄ μƒ μ„Έμ…μ΄ μ μ ν•λ¬ μ¶λ°. BUT μ λ‹ν¬μ μ•½μ— κ±Έλ¦° μƒν™© 

- νΈλμ­μ… μλ™ μ™„λ£ μ•λ¨